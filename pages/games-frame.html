<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="icon" href="/storage/images/googleclassroom.png" type="image/png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="/storage/css/iframe2.css" rel="stylesheet">

    <style>
        .ad-box {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 160px;
            height: 600px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 15px;
            border: 2px solid rgba(255,255,255,0.35);
            overflow: hidden;
            z-index: 9999;
            display: flex;
            flex-direction: column;
        }
        .ad-box iframe { position: relative; z-index: 1; }
        .ad-close {
            position: absolute;
            top: 5px;
            right: 5px;
            width: auto;
            text-align: center;
            padding: 2px 6px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 4px black;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            z-index: 10001;
        }
        .ad-box.left { left: 20px; }
        .ad-box.right { right: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="content">

        <div class="ad-box left" id="ad-left">
            <div class="ad-close" onclick="closeAd('ad-left')">×</div>
<script>
  atOptions = {
    'key' : '540294eec56fbe02dbcdfc98d8f0434c',
    'format' : 'iframe',
    'height' : 600,
    'width' : 160,
    'params' : {}
  };
</script>
<script src="https://enoughprosperabsorbed.com/540294eec56fbe02dbcdfc98d8f0434c/invoke.js"></script>
        </div>

        <div id="ruffle" style="width:100%;height:100%;display:none;"></div>
        <iframe id="game-frame" class="game-iframe" allowfullscreen style="display:block;"></iframe>

        <div class="ad-box right" id="ad-right">
            <div class="ad-close" onclick="closeAd('ad-right')">×</div>
<script>
  atOptions = {
    'key' : '540294eec56fbe02dbcdfc98d8f0434c',
    'format' : 'iframe',
    'height' : 600,
    'width' : 160,
    'params' : {}
  };
</script>
<script src="https://enoughprosperabsorbed.com/540294eec56fbe02dbcdfc98d8f0434c/invoke.js"></script>
        </div>

    </div>
</div>

<script>
function loadLocalRuffle() {
    var script = document.createElement('script');
    script.src = '/storage/ruffle/ruffle.js';
    document.body.appendChild(script);
}

var cdnScript = document.createElement('script');
cdnScript.src = 'https://unpkg.com/@ruffle-rs/ruffle';
cdnScript.onerror = loadLocalRuffle;
document.body.appendChild(cdnScript);
</script>

<script>
function closeAd(adId) {
    const ad = document.getElementById(adId);
    if (!ad) return;
    ad.style.display = 'none';
    setTimeout(() => { ad.style.display = 'flex'; }, 300000);
}

document.querySelectorAll('.ad-close').forEach(btn => {
    btn.addEventListener('click', function() {
        closeAd(this.parentElement.id);
    });
});

function removeAd(adId) {
    const ad = document.getElementById(adId);
    if (ad) ad.remove();
}

if (localStorage.getItem('Ads') === 'false') {
    removeAd('ad-left');
    removeAd('ad-right');
}
</script>

<script>
function getUrlParameter(name) {
    return new URLSearchParams(window.location.search).get(name);
}

function loadGame() {
    const iframe = document.getElementById('game-frame');
    const ruffleContainer = document.getElementById('ruffle');
    const url = getUrlParameter('url') || '/404';

    if (url.startsWith('/pages/games/flash/') || url.toLowerCase().includes('.swf')) {
        iframe.style.display = 'none';
        ruffleContainer.style.display = 'block';

        const initRuffle = () => {
            ruffleContainer.innerHTML = '';
            const ruffle = window.RufflePlayer.newest();
            const player = ruffle.createPlayer();
            player.id = "player";
            player.style.width = "100%";
            player.style.height = "100%";
            ruffleContainer.appendChild(player);
            player.load(url);
        };

        if (window.RufflePlayer) {
            initRuffle();
        } else {
            const interval = setInterval(() => {
                if (window.RufflePlayer) {
                    clearInterval(interval);
                    initRuffle();
                }
            }, 100);
        }
    } else {
        ruffleContainer.style.display = 'none';
        iframe.style.display = 'block';
        iframe.src = url;
    }
}

document.addEventListener('DOMContentLoaded', loadGame);
</script>

<script src="/storage/js/settings-1.js"></script>
<script src="/explore/us5/us5.bundle.js" defer></script>
<script src="/explore/us5/us5.config.js" defer></script>
<script src="/explore/register-sw.js" defer></script>
<script src="/explore/search.js" defer></script>
<script src="/explore/index.js" defer></script>

<script>
async function regsw() {
    await navigator.serviceWorker.register("/explore/us5-sw.js", { scope: "/explore/" });
}
regsw();
</script>

<script src="/storage/js/background.js"></script>
</body>
</html>
